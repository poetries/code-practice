<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
		</style>
	</head>
	<body>
		
		<img src="img/2.jpg" id="pic"/>
		<script type="text/javascript">
			var img = document.getElementById("pic");
			//complete判断是否加载完成 完成返回true
			//onerror 图片加载失败 调用
			//onload 加载完成
			//readStatus = "complete"状态
			//readStatus = "loading"状态
			if(img.complete || img.readyState == "complete" || img.readyState == "loading"){
				draw();
				
			}else{
				img.onload = function(){
				
				}
			}
			
			function draw(){
				//创建canvas节点	
				var can = document.createElement("canvas");
				can.style.position = "absolute";
				can.style.left = img.offsetLeft +"px";
				can.style.top = img.offsetTop +"px";
				can.width = img.width;
				can.height = img.height;
				img.parentNode.insertBefore(can,img);
				var ctx = can.getContext("2d");
				ctx.fillStyle = "#bbb";
				ctx.fillRect(0,0,can.width,can.height);
				
				//合成覆盖显示透明色
				ctx.globalCompositeOperation = "destination-out";
				ctx.strokeStyle = "#eee";
				ctx.lineJoin = "round";
				ctx.lineWidth = 30;
				
				can.onmousedown = function(ev){
					var ev = ev || window.event;
					var x = ev.pageX - this.offsetLeft;
					var y = ev.pageY - this.offsetTop;
					
					ctx.beginPath();
					ctx.arc(x,y,15,0,360,false);
					ctx.fill();
					ctx.closePath();
					
					can.onmousemove = function(ev){
						var ev = ev || window.event;
						var x = ev.pageX - this.offsetLeft;
						var y = ev.pageY - this.offsetTop;
						
						ctx.beginPath();
						ctx.moveTo(x,y);
						ctx.closePath();
					}
				}
			}
			
			
			
		</script>
	</body>
</html>
